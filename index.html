<!doctype html>I
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouTube Gallery</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#ff3b30}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071029 0%, #071827 100%);color:#e6eef6;padding:24px}
    .wrap{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .panel{background:rgba(255,255,255,0.03);padding:14px;border-radius:10px;box-shadow:0 6px 14px rgba(2,6,23,0.6)}
    form{display:flex;gap:8px;flex-wrap:wrap}
    input[type=text]{flex:1;min-width:220px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}

    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:16px}
    .card{background:var(--card);border-radius:10px;overflow:hidden;cursor:grab;user-select:none}
    .thumb{position:relative;padding-top:56.25%;background:#000}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .card .meta{padding:10px}
    .title{font-size:14px;margin:0 0 6px}
    .meta .small{font-size:12px;color:var(--muted)}
    .card .actions{display:flex;gap:6px;margin-top:8px}
    .icon-btn{padding:6px 8px;border-radius:7px;border:0;background:rgba(255,255,255,0.04);color:inherit;cursor:pointer}

    /* modal */
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.7);display:none;align-items:center;justify-content:center;padding:24px}
    .modal.open{display:flex}
    .player{width:min(1100px,95%);height:min(620px,60vh);background:#000;border-radius:10px;overflow:hidden}
    .player iframe{width:100%;height:100%;border:0}

    .toolbar{display:flex;gap:8px;align-items:center}
    .small-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}

    footer{margin-top:18px;color:var(--muted);font-size:13px}

    @media (max-width:520px){header{flex-direction:column;align-items:stretch}form{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>YouTube Gallery</h1>
        <div class="muted">Paste YouTube URLs to add them to your gallery. Data is stored locally in your browser.</div>
      </div>
      <div class="toolbar">
        <button id="exportBtn" class="small-btn">Export JSON</button>
        <button id="importBtn" class="small-btn">Import JSON</button>
        <button id="clearBtn" class="small-btn">Clear All</button>
      </div>
    </header>

    <section class="panel">
      <form id="addForm">
        <input id="urlInput" type="text" placeholder="YouTube URL (or ID) â€” e.g. https://youtu.be/dQw4w9WgXcQ" required />
        <input id="titleInput" type="text" placeholder="Optional title (leave blank to fetch)" />
        <button type="submit">Add</button>
      </form>
      <div class="muted" style="margin-top:8px">You can drag cards to reorder. Click a thumbnail to play.</div>
    </section>

    <div id="gallery" class="gallery" aria-live="polite"></div>

    <div id="modal" class="modal" role="dialog" aria-hidden="true">
      <div class="player panel">
        <iframe id="playerFrame" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>
    </div>

    <footer class="muted">Built with a single static file. Host anywhere (GitHub Pages works). Thumbnails are fetched from YouTube.</footer>
  </div>

  <script>
    // Simple YouTube ID extractor
    function extractYouTubeID(url){
      if(!url) return null;
      // if user enters just an ID
      if(/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
      try{
        const u = new URL(url);
        if(u.hostname === 'youtu.be') return u.pathname.slice(1);
        if(u.searchParams.get('v')) return u.searchParams.get('v');
        // sometimes embed urls: /embed/ID
        const m = u.pathname.match(/\/embed\/([-_a-zA-Z0-9]{11})/);
        if(m) return m[1];
      }catch(e){
        // not a URL, maybe it's an ID
        if(/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
      }
      // fallback regex
      const rg = url.match(/(?:v=|\/v\/|youtu\.be\/|embed\/)([-_a-zA-Z0-9]{11})/);
      return rg ? rg[1] : null;
    }

    const LS_KEY = 'yt_gallery_v1';
    let items = JSON.parse(localStorage.getItem(LS_KEY) || '[]');

    const gallery = document.getElementById('gallery');
    const form = document.getElementById('addForm');
    const urlInput = document.getElementById('urlInput');
    const titleInput = document.getElementById('titleInput');
    const modal = document.getElementById('modal');
    const playerFrame = document.getElementById('playerFrame');

    function save(){
      localStorage.setItem(LS_KEY, JSON.stringify(items));
    }

    function createCard(item, index){
      const card = document.createElement('div');
      card.className = 'card';
      card.draggable = true;
      card.dataset.index = index;

      card.innerHTML = `
        <div class="thumb"><img src="${item.thumb}" alt="${escapeHtml(item.title||'YouTube video')}"></div>
        <div class="meta">
          <h3 class="title">${escapeHtml(item.title||'Untitled')}</h3>
          <div class="small">ID: ${item.id}</div>
          <div class="actions">
            <button class="icon-btn play">Play</button>
            <button class="icon-btn copy">Copy URL</button>
            <button class="icon-btn edit">Edit</button>
            <button class="icon-btn del">Delete</button>
          </div>
        </div>
      `;

      // events
      card.querySelector('.play').addEventListener('click',()=>openPlayer(item.id));
      card.querySelector('.copy').addEventListener('click',()=>{
        navigator.clipboard.writeText('https://youtu.be/'+item.id).then(()=>{
          flash('Copied to clipboard');
        });
      });
      card.querySelector('.del').addEventListener('click',()=>{
        if(confirm('Delete this video?')){
          items.splice(index,1); rerender(); save();
        }
      });
      card.querySelector('.edit').addEventListener('click',()=>{
        const newTitle = prompt('Edit title', item.title||'');
        if(newTitle !== null){ item.title = newTitle; save(); rerender(); }
      });

      // drag events
      card.addEventListener('dragstart', (e)=>{
        e.dataTransfer.setData('text/plain', index);
        card.style.opacity = '0.5';
      });
      card.addEventListener('dragend', ()=>{ card.style.opacity=''; });

      // allow drop on cards
      card.addEventListener('dragover', (e)=>{ e.preventDefault(); card.style.outline = '2px dashed rgba(255,255,255,0.06)'; });
      card.addEventListener('dragleave', ()=>{ card.style.outline=''; });
      card.addEventListener('drop', (e)=>{
        e.preventDefault(); card.style.outline='';
        const srcIndex = Number(e.dataTransfer.getData('text/plain'));
        const dstIndex = Number(card.dataset.index);
        if(!isNaN(srcIndex) && !isNaN(dstIndex) && srcIndex !== dstIndex){
          const [moved] = items.splice(srcIndex,1);
          items.splice(dstIndex,0,moved);
          save(); rerender();
        }
      });

      return card;
    }

    function rerender(){
      gallery.innerHTML = '';
      items.forEach((it,i)=>gallery.appendChild(createCard(it,i)));
    }

    function openPlayer(id){
      playerFrame.src = `https://www.youtube.com/embed/${id}?autoplay=1&rel=0`;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
    }

    modal.addEventListener('click',(e)=>{
      if(e.target === modal){
        playerFrame.src = '';
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
      }
    });

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const raw = urlInput.value.trim();
      const id = extractYouTubeID(raw);
      if(!id){ alert('Could not find a YouTube ID in that URL.'); return; }
      const thumb = `https://img.youtube.com/vi/${id}/hqdefault.jpg`;
      const title = titleInput.value.trim() || `YouTube video (${id})`;

      items.push({id, title, thumb, added:Date.now()});
      save(); rerender();
      form.reset(); urlInput.focus();
    });

    // export/import
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(items, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'yt-gallery.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    document.getElementById('importBtn').addEventListener('click', ()=>{
      const input = document.createElement('input'); input.type='file'; input.accept='application/json';
      input.addEventListener('change', ()=>{
        const f = input.files[0]; if(!f) return;
        const reader = new FileReader(); reader.onload = ()=>{
          try{
            const arr = JSON.parse(reader.result);
            if(Array.isArray(arr)){
              items = arr; save(); rerender(); flash('Imported');
            }else alert('Invalid JSON format');
          }catch(err){ alert('Failed to parse JSON'); }
        }; reader.readAsText(f);
      });
      input.click();
    });

    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(confirm('Clear all videos from this gallery?')){ items = []; save(); rerender(); }
    });

    function flash(msg){
      const el = document.createElement('div');
      el.textContent = msg; el.style.position='fixed'; el.style.bottom='20px'; el.style.left='50%'; el.style.transform='translateX(-50%)';
      el.style.padding='10px 14px'; el.style.background='rgba(0,0,0,0.5)'; el.style.border='1px solid rgba(255,255,255,0.06)'; el.style.borderRadius='8px'; el.style.zIndex=9999;
      document.body.appendChild(el);
      setTimeout(()=>el.style.opacity='0',1200);
      setTimeout(()=>el.remove(),1800);
    }

    function escapeHtml(s){ return (s+'').replace(/[&<>\"']/g, (c)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }

    // initial render
    rerender();

  </script>
</body>
</html>
